'use strict';
var Twitter = require('ntwitter');
var io = require('socket.io').listen(9003);
var EE = require('events').EventEmitter;
var pubsub = new EE();
var twitterClient = new Twitter({
    consumer_key: "2QaajODxbrgMqNTY7A7A1w",
  	consumer_secret: "usDzR0W9Pg9eRVT7OXtq5IIm7U1VVxuLRTCNSKzUvRE",
  	access_token_key: "usDzR0W9Pg9eRVT7OXtq5IIm7U1VVxuLRTCNSKzUvRE",
  	access_token_secret: "jjXzv4hBAtWTnvbnCGnZ0MYHrcjM4ZcOWdv3aAF5p49c1"
});

twitterClient.stream('statuses/filter', {'track': 'God'}, function(stream) {
  stream.on('data', function (data) {
    pubsub.emit('tweet', data);
  });
});

io.sockets.on('connection', function  (socket) {
    // Au moins un user connect√©
    pubsub.on('tweet', function  (tweet) {
        socket.emit('tweet', tweet);
    });
})